## EDB Postgres Enterprise Manager:

PostgreSQL Enterprise Manager (PEM) is EDB’s enterprise-grade monitoring and management platform for PostgreSQL ecosystems.


_Before the Installation guide, you need to know the following:_

- The **PEM Server requires a backend Postgres instance** that it will use to store monitored data.
- This database can be **EDB advanced server or PostgreSQL** with a database known as PEM inside of it.
- PEM can use an existing Postgres in your local machine, or you will be prompted to install a new one as the backend database.
- The PEM **HTTPD or nginx** may or may not be in the same machine as the host of PEM server.
- The **PEM Agent** can remotely manage a host, it must not be in the same machine as the host.



### What is PostgreSQL Enterprise Manager (PEM)?

**PEM** is an enterprise monitoring and management tool by **EDB** that provides:
- Web-based PostgreSQL monitoring
- Alerts & metrics
- Query performance analysis
- Server & database management
- Works with **PostgreSQL**, **EDB Postgres Advanced Server**

- Architecture:
    - **PEM Server** → PEM Server needs its own database for storing information on all its target databases. Central monitoring server (web UI + database).
    - **PEM Agent** → is lightweight software that is installed on database server hosts. Installed on PostgreSQL servers to collect metrics.



### What PEM Can Monitor:

#### 1. PostgreSQL/EPAS:
- Connections
- Locks
- Query execution time
- Long-running queries
- Index usage
- Autovacuum
- WAL activity
- Replication lag

#### 2. OS Metrics:
- CPU
- Memory
- Disk I/O
- Network

#### 3. HA / Replication:
- Primary / Standby status
- Streaming replication lag
- Slot usage
- Failover detection




### PEM Architecture:

```
Browser
   |
   v
PEM Web UI (8443) - Dashboard & admin
   |
   v
PEM Server  ── PostgreSQL/EPAS (pem database) - Stores metrics, alerts, history
   |
   v
PEM Agent(s)   - Collects DB + OS metrics
   |
   v
PostgreSQL / OS / Replication
```




### Components Required:

| Component          | Purpose                          |
| ----------         | -------------------------------- |
| PostgreSQL or EPAS | Backend DB for PEM               |
| PEM Server         | Web UI + monitoring              |
| PEM Agent          | Collects metrics from DB servers |



### Target Setup:

| Server           | IP               | Role                           |
| ---------------- | ---------------- | ------------------------------ |
| **EPAS Primary** | `192.168.10.191` | EDB Postgres AS 16 + PEM Agent |
| **EPAS Standby** | `192.168.10.192` | EDB Postgres AS 16 + PEM Agent |
| **PEM Server**   | `192.168.10.193` | PEM Server + PEM DB            |



---
---



## Installing PEM Server (192.168.10.193):


### Configure PEM Backend DB (PostgreSQL or EPAS):

_Here, used EPAS DB:_
```
psql edb

ALTER ROLE enterprisedb IDENTIFIED BY 'mypassword';
```


#### `pg_monitor` Role:

pg_monitor is a **built-in PostgreSQL role** designed specifically for monitoring tools.

_It allows read-only access to:_

| What               | Example               |
| ------------------ | --------------------- |
| System views       | `pg_stat_activity`    |
| Query stats        | `pg_stat_statements`  |
| Locks              | `pg_locks`            |
| Replication        | `pg_stat_replication` |
| WAL stats          | `pg_stat_wal`         |
| Background workers | `pg_stat_bgwriter`    |
| Autovacuum         | `pg_stat_progress_*`  |



```
CREATE ROLE pem_monitor WITH LOGIN PASSWORD 'mypassword';

GRANT pg_monitor TO pem_monitor;
```



### Install PEM packages:

_Installing EDB Postgres Enterprise Manager:_
```
dnf install -y edb-pem 
```


If you're using **EDB Postgres Advanced Server**, you can install the `sslutils` extension as follows, where `<x>` is the EPAS version.

```
dnf install -y edb-as16-server-sslutils
```



_Installing on EPAS client database node:_
```
dnf install -y edb-pem-agent 
```



### Initial configuration:

```
/usr/edb/pem/bin/configure-pem-server.sh
```


```
### Output:

Install type: 1:Web Services and Database, 2:Web Services 3: Database [ ] : 1

Enter local database server installation path (i.e. /usr/edb/as12 , or /usr/pgsql-12, etc.) [ ] : /usr/edb/as16

Enter database super user name [ ] : enterprisedb

Enter database server port number [ ] : 5444

-->  [Info] -->  [Info] Checking database server port number: 5444

Enter database super user password [ ] :

Please enter CIDR formatted network address range that agents will connect to the server from, to be added to the server's pg_hba.conf file. For example, 192.168.1.0/24 [ 0.0.0.0/0 ] 192.168.10.0/24
Enter database systemd unit file or init script name (i.e. edb-as-12 or postgresql-12, etc.) [ ] : edb-as-16

Please specify agent certificate path (Script will attempt to create this directory, if it does not exists) [ /root/.pem/ ] :

Please specify PEM web server (openssl) certificate subject, template: /C=CountryCode/ST=StateName/L=CityName/O=CompanyName/OU=CompanySectionName/CN=CommonNameOrHostname/emailAddress=EmailAddress [ ] : /C=BD/ST=Dhaka/L=Dhaka/O=Technbd/OU=DBA/CN=pem-server/emailAddress=admin@technbd.com

...
...

Signature ok
subject=C = BD, ST = Dhaka, L = Dhaka, O = Technbd, OU = DBA, CN = pem-server, emailAddress = admin@technbd.com
Getting Private key
C = BD, ST = Dhaka, L = Dhaka, O = Technbd, OU = DBA, CN = pem-server, emailAddress = admin@technbd.com
error 18 at 0 depth lookup: self signed certificate
error server-pem.crt: verification failed
-->  [Info] -->  [Info] Checking whether the SSL certificates is EDB one or not.
-->  [Info] -->  [Info] Configuring uWSGI ...
ipv6 is enabled
-->  [Info] -->  [Info] Executing /usr/edb/pem/web/setup.py
/usr/edb/pem/web/venv/lib/python3.10/site-packages/passlib/pwd.py:16: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
pgAdmin 4 - Application Initialisation
======================================

-->  [Info] -->  [Info] Check and Configure SELinux security policy for PEM
 getenforce found, now executing 'getenforce' command
 *********************************************************************
 INFO - No SELinux policy is loaded.
 *********************************************************************
 If SELinux security policy in future changed to permissive / enforcing
 then you need to execute /usr/edb/pem/bin/configure-selinux.sh script manually to configure
 it with PEM.
 Skiping SELinux policy for PEM
-->  [Info] -->  [Info] Executing systemctl restart edb-uwsgi
-->  [Info] -->  [Info] Executing systemctl restart nginx
-->  [Info] -->  [Info] Executing systemctl enable edb-uwsgi
Created symlink /etc/systemd/system/multi-user.target.wants/edb-uwsgi.service → /etc/systemd/system/edb-uwsgi.service.
-->  [Info] -->  [Info] Executing systemctl enable nginx
Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /usr/lib/systemd/system/nginx.service.
-->  [Info] -->  [Info] Configured the webservice for EDB Postgres Enterprise Manager (PEM) Server on port '8443'.
-->  [Info] -->  [Info] PEM server can be accessed at https://127.0.0.1:8443/pem at your browser
```



### PEM Web Console:
Login to PEM UI: 
- User: `enterprisedb`
- Password: your_password

- After logged, here on the left panel you will notice there’s already one database present under `PEM Server Directory` folder, this is the **same database which we have configured/used PEM server**, hence it will be automatically added to the server list. We will manually add one more database cluster to explain how to do it explicitly.

- Now, let’s add another database to the monitoring console. I will be adding a community PostgreSQL database or EPAS to it. Go to `PEM Server Directory` folder right click on it, choose option:  `Register`-> `Server`.
    - General: 
        - Name: primary-191
        - Server group/cluster: `PEM Server Directory` 
    - Connection:
        - Host name/Address: `192.168.10.191`
        - Port: `5444`
        - Maintenance database: `postgres`
        - Username: `enterprisedb`
        - Password: 
    - PEM Agent: -> Connection Parameters: 
        - Bound agent: `Postgres Enterprise Manager Host`
        - Remote monitoring: N/A
        - Host: `192.168.10.191`
        - Port: `5444`
        - SSL: Prefer
        - Database: `postgres`
        - Username: `enterprisedb`
        - Password:
        - Confirm password: 
    - Save 



_To Browse:_
```
https://server_ip:8443/pem
```



### PEM Licensing:

**PEM is free to install**, but advanced features require **EDB license**.

| Edition          | Notes                    |
| ---------------- | ------------------------ |
| Community        | Limited features         |
| Enterprise       | Full monitoring & alerts |
| EDB Subscription | Required for production  |



### Ref: 
- [Installing Postgres Enterprise Manager](https://www.enterprisedb.com/docs/pem/latest/installing/linux_x86_64/pem_other_linux_8/)


