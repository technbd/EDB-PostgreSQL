## EDB Postgres Advanced Server Replication:

Below is a clean, production-style guide to setting up EPAS (EDB Postgres Advanced Server) streaming replication between Primary and Standby. 


### Architecture:

| Role               | IP                 |
| ------------------ | ------------------ |
| EDB PostgreSQL Primary | **192.168.10.191** |
| EDB PostgreSQL Standby | **192.168.10.192** |



## Primary Server: (192.168.10.191)

_Default Data and Binary Directory:_
```
Data directory  : /var/lib/edb/as16/data
Binary path     : /usr/edb/as16/bin
```


### Configure `postgresql.conf`:

```conf

# - Connection Settings -
listen_addresses = '*'
port = 5444
max_connections = 100

# - Authentication -
authentication_timeout = 1min
password_encryption = md5

# - Memory -
shared_buffers = 4096MB
huge_pages = try
temp_buffers = 128MB
work_mem = 128MB

# WRITE-AHEAD LOG
# - Settings -
wal_level = replica
wal_log_hints = on

# - Archiving -
#archive_mode = on		### archive mode on
#archive_command = 'cp %p /var/lib/edb/as16/archive/%f'

# REPLICATION
# - Sending Servers -
max_wal_senders = 10
max_replication_slots = 10

# - Primary Server -

# - Standby Servers -
hot_standby = on
```


_Create archive directory:_
```
mkdir -p /var/lib/edb/as16/archive
chown -R enterprisedb:enterprisedb /var/lib/edb/as16/archive
```


### Configure `pg_hba.conf`:

```conf

# Replication access:
host    replication     replicator      192.168.10.191/32   md5
host    replication     replicator      192.168.10.192/32   md5
```



### Restart Primary Server:

```
systemctl restart edb-as-16
systemctl status edb-as-16
```



### Create replication user:

_Create replication user:_
```
CREATE USER replicator REPLICATION LOGIN ENCRYPTED PASSWORD 'replicator';
```


_Change `enterprisedb` password:_
```
ALTER ROLE enterprisedb IDENTIFIED BY 'password';
```


_Check Existing Replication Slots:_
```
SELECT * FROM pg_replication_slots;

SELECT slot_name, slot_type, active FROM pg_replication_slots;
```


_If drop the existing slot:_
```
SELECT pg_drop_replication_slot('standbyslot1');
```



---
---



## Standby Server: (192.168.10.192)


### Stop Standby Server:

```
systemctl stop edb-as-16
```


### Clean Data Directory:

```
cd /var/lib/edb/as16/data

rm -rf *
```




### Take Base Backup from Primary:

```
su - enterprisedb
```


```
pg_basebackup -h 192.168.10.191 -U replicator -p 5444 -D /var/lib/edb/as16/data -P -v -R -X stream -C -S standbyslot1
```



_Verify Standby Config:_
```
cat /var/lib/edb/as16/data/postgresql.auto.conf

ll /var/lib/edb/as16/data/standby.signal
```


### Start Standby:

```
systemctl start edb-as-16
systemctl status edb-as-16
```




## Verify Replication:

#### On Primary: 

```
select client_addr, state, sync_state from pg_stat_replication;
```


```
SELECT slot_name, slot_type, active FROM pg_replication_slots;
```


#### On Standby:

```
SELECT pg_is_in_recovery();
```






